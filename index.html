<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#eef" />
    <link rel="icon" href="favicon.svg" type="image/x-icon">
    <title>codebehind </title>
    <script src='codebehind.js' defer></script>
  </head>
  <body>
    <section>
      <a href="page1">page1</a>
      <a href="page2">page2</a>
    </section>
    <code-behind>here</code-behind>

    <script>

      // the nav is where each page to display
      // they (currently) need a function called page to operate
      // page receives a callback function thay does nothing so far
      const nav={
        'page1': './page1.js',
        'page2': './page2.js',
      };

      // these will be the modules loaded ie modules[].page()
      let modules={};


      // the actual page loader
      for(n in nav){
        console.log(nav[n]);
        
        let i = 0;
        let name=n;
        import(nav[n]).then(module => {
          module['page']();
          modules[name]={...module};
        });
      }

      console.log(modules);
      

      // this is the navigation intceptor
      navigation.addEventListener("navigate", event => {

        console.log(event);

        //cross-origin navs
        if (!event.canIntercept) {
          return;
        }
        // fragment navigations or downloads.
        if (event.hashChange || event.downloadRequest !== null) {
          return;
        }

        const url=new URL(event.destination.url);
        console.log(url);
        const name = url.pathname.replace("/","");
        console.log(name);

        event.intercept({
          async handler() {

            const renderHtml = modules[name].page();
            const cb = document.querySelector('code-behind');
            cb.innerHTML = renderHtml;
          }
        }) // need to add the error handler

      });

    </script>

</body>
</html>